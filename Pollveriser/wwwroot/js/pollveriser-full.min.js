var PVR_VAR_DataTags=[],PVR_VAR_CurrentPath="";const PVR_CONST_ENABLE_TAG="[data-pvr-enable]",PVR_CONST_TARGET_TAG="[data-pvr-tag]";var pvr_coreService={selectAnswer:async function(n,t,i){let r=await pvr_apiService.submitAnswer(n);pvr_clientStoreService.setClientPollVote(t,n);typeof i=="function"&&i(r)},getPollsForCurrentPage:async function(){var n,i,t;let u=document.querySelector(PVR_CONST_ENABLE_TAG)||[];if(u.length!=0){let r=document.querySelector(PVR_CONST_TARGET_TAG)||[];for(n=0;n<r.length;n++)for(i=r[n].attributes[PVR_CONST_TARGET_TAG].value.split(","),t=0;t<i.length;t++)PVR_VAR_DataTags.push(i[t]);return PVR_VAR_CurrentPath=window.location.pathname,await pvr_apiService.getActivePolls(PVR_VAR_CurrentPath,PVR_VAR_DataTags)}}},pvr_apiService={getActivePolls:async function(n,t){let i={CurrentUrlPath:n,DataTags:t},r=await fetch("/api/pollveriser",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});return await r.json()},submitAnswer:async function(n){let t=await fetch(`/api/pollveriser?answerId=${n}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({answerId:n})});return await t.json()},getQuestionAnswers:async function(n){let t=await fetch(`/api/pollveriser?questionId=${n}`,{method:"GET"});return await t.json()}},pvr_renderService={buildAnswerPod:function(n){return`<div class="pvr-poll--question__answer-pod pvr-poll--question__answer-pod--no-answer" data-answer-id="${n.id}">${n.text}</div>`},buildQuestionContainer:function(n){let i="";for(var t=0;t<n.answers.length;t++)i+=pvr_renderService.buildAnswerPod(n.answers[t]);return`<div class="pvr-poll--question" data-question-id="${n.id}">
            <div class="pvr-poll--question--text">${n.text}</div>
            <div class="pvr-poll--question--answers">${i}</div>
            </div>`},buildPoll:function(n){let i="";for(var t=0;t<n.questions.length;t++)i+=pvr_renderService.buildQuestionContainer(n.questions[t]);return`<div class="pvr-poll pvr-poll__bottom-right" data-poll-id="${n.id}">
            <div class="pvr-poll--title">${n.name}</div>
            <div class="pvr-poll--questions">${i}</div>
            </div>`},applyAnswerData:function(n,t,i){let u=n.querySelectorAll(".pvr-poll--question__answer-pod")||[];for(var r=0;r<u.length;r++){let e=u[r].attributes["data-answer-id"].value,f=t.answerCounts[e],n=document.createElement("div");n.classList.add("pvr-poll--question__answer-pod--result");e==i&&n.classList.add("pvr-poll--question__answer-pod--result__chosen");u[r].classList.remove("pvr-poll--question__answer-pod--no-answer");u[r].appendChild(n);n.style.setProperty("--pvr-answer-width","0");n.style.setProperty("--pvr-hover-width",`${f.percentageChosen}%`);let o=function(){n.style.setProperty("--pvr-answer-width",`${f.percentageChosen}%`)},s=function(){n.style.setProperty("--pvr-answer-data",`"${f.timesChosen} votes"`);n.classList.add("pvr-poll--question__answer-pod--result__complete")};setTimeout(o,100);setTimeout(s,1100)}}},pvr_clientStoreService={__CONST_storageKey:"pvr_data",__setLocalStorage:function(n){localStorage.setItem(this.__CONST_storageKey,JSON.stringify(n))},__getLocalStorage:function(){return JSON.parse(localStorage.getItem(this.__CONST_storageKey)||"{}")},getClientPollVote:function(n){var t=this.__getLocalStorage();return t[n]},setClientPollVote:function(n,t){var i=this.__getLocalStorage();i[n]=t;this.__setLocalStorage(i)},clearClientPollVote:function(n){var t=this.__getLocalStorage();t[n]=!1;this.__setLocalStorage(t)}},pvr_init=function(){function n(n){document.readyState!=="loading"?n():document.addEventListener("DOMContentLoaded",n)}n(async function(){var i=await pvr_coreService.getPollsForCurrentPage(),t,f;if(i.length!=0){let r=i[0];t=pvr_clientStoreService.getClientPollVote(r.questions[0].id);let e=pvr_renderService.buildPoll(r),n=document.createElement("div");n.innerHTML=e;let u=async function(n,t){let i=n.parentElement,r=n.attributes["data-answer-id"].value,u=i.parentElement.attributes["data-question-id"].value;if(t)pvr_coreService.selectAnswer(r,u,function(n){pvr_renderService.applyAnswerData(i,n,r)});else{let n=await pvr_apiService.getQuestionAnswers(u);pvr_renderService.applyAnswerData(i,n,r)}};if(t)f=n.querySelectorAll(`.pvr-poll--question__answer-pod[data-answer-id="${t}"]`)[0],u(f,!1);else{let t=function(i){i.target.closest(".pvr-poll--question__answer-pod")&&(n.removeEventListener("click",t),u(i.target,!0))};n.addEventListener("click",t)}document.body.appendChild(n)}})};pvr_init();