var PVR_VAR_DataTags=[],PVR_VAR_CurrentPath="";const PVR_CONST_ENABLE_TAG="[data-pvr-enable]",PVR_CONST_TARGET_TAG="[data-pvr-tag]";var pvr_coreService={selectAnswer:async function(n,t,i){let r=await pvr_apiService.submitAnswer(n);pvr_clientStoreService.setClientPollVote(t,n);typeof i=="function"&&i(r)},getPollsForCurrentPage:async function(){var n,i,t;let u=document.querySelector(PVR_CONST_ENABLE_TAG)||[];if(u.length!=0){let r=document.querySelector(PVR_CONST_TARGET_TAG)||[];for(n=0;n<r.length;n++)for(i=r[n].attributes[PVR_CONST_TARGET_TAG].value.split(","),t=0;t<i.length;t++)PVR_VAR_DataTags.push(i[t]);return PVR_VAR_CurrentPath=window.location.pathname,await pvr_apiService.getActivePolls(PVR_VAR_CurrentPath,PVR_VAR_DataTags)}}},pvr_apiService={getActivePolls:async function(n,t){let i={CurrentUrlPath:n,DataTags:t},r=await fetch("/api/pollveriser",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});return await r.json()},submitAnswer:async function(n){let t=await fetch(`/api/pollveriser?answerId=${n}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({answerId:n})});return await t.json()},getQuestionAnswers:async function(n){let t=await fetch(`/api/pollveriser?questionId=${n}`,{method:"GET"});return await t.json()}},pvr_renderService={renderPoll:function(n){var u=ReactDOM.createRoot(n.targetElement)}},pvr_clientStoreService={__CONST_storageKey:"pvr_data",__setLocalStorage:function(n){localStorage.setItem(this.__CONST_storageKey,JSON.stringify(n))},__getLocalStorage:function(){return JSON.parse(localStorage.getItem(this.__CONST_storageKey)||"{}")},getClientPollVote:function(n){var t=this.__getLocalStorage();return t[n]},setClientPollVote:function(n,t){var i=this.__getLocalStorage();i[n]=t;this.__setLocalStorage(i)},clearClientPollVote:function(n){var t=this.__getLocalStorage();t[n]=!1;this.__setLocalStorage(t)}},pvr_init=function(){function n(n){document.readyState!=="loading"?n():document.addEventListener("DOMContentLoaded",n)}n(async function(){var r=await pvr_coreService.getPollsForCurrentPage(),t,i,u;if(r.length!=0){let n=r[0];t=pvr_clientStoreService.getClientPollVote(n.questions[0].id);i={};t&&(i=await pvr_apiService.getQuestionAnswers(n.questions[0].id));u={poll:n,existingAnswerId:t,resultsData:i,targetElement:document.getElementById("pollveriser_target")};pvr_renderService.renderPoll(u)}})};pvr_init();